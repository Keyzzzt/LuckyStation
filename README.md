# Lucky Station Backend API

### Список всех пользователей:

    Добавление
        - При регистрации
        - При покупке без регистрации /// не реализовано ///
        - При подписке с регистрацией
        - При подписке с без регистрации
    Удаление
        - админом /// не реализовано ///

### Список subscribed пользователей:

    Добавление
        - при подписке с регистрацией
        - при подписке без регистрации
    Удаление
        - админом /// не реализовано ///
        - при отписке через ссылку в имейле рассылки /// не реализовано ///

### Модель пользователей купивших не зарегистрировавшись:

### Модель сообщений формы обратной связи:

    user - _id если зарегистрированный, имейл если нет

### Endpoints:

    GET     /api/auth           Authorization
    POST    /api/auth           Login
    DELETE  /api/auth           Logout
    POST    /api/auth/reg       Common registration
    GET     /api/auth/google
    GET     /api/product        Fetch all products
    GET     /api/product/:id    Fetch single product

### Для получения информации от sendgrid

    В параллельном терминале запускаем yarn tunnel

### Авторизация обычным способом и Google OAUTH 2.0

    1.  Если пользователь зарегистрировался обычным способом, то ему необходимо верифицировать почту перейдя по ссылке
            отправленной ему на указанную им почту. Пользователь с не верфицированной почтой не может залогиниться.
            Ссылка действительна 24ч
    2.  Если пользователь входит при помощи Google то есть несколько вариантов развития событий:
        a.  Пользователь с таким имейл уже зарегистрирован обычным способом, но имейл не верифицирован - удаляется этот пользователь и        создается аккаунт для Google авторизации. После создания Google аккаунта, регистрация обычным способом с таким же имейлом  невозможна.
        b.  Пользователь с таким имейл уже зарегистрирован обычным способом, и имейл верифицирован - происходит слияние и на этот аккаунт возможно зати обоими способами.
        с.  Пользователя с таким имейл нет - создается  аккаунт для Google авторизации. После создания Google аккаунта, регистрация обычным способом с таким же имейлом  невозможна.

### TODO

Отобразить на всех страницах актуальные fail / success чтобы понять где нужен reset
Sendgrid Работает не корректно, письма отправляет, но нет рузельтатов ответа пользователей
Разобраться с "/:keyword?/:page?/:limit?"
Инициализация проекта - смотреть камасутру
Оплата без регистрации
Drag&Drop изображения при создании товара
Редиректы при удачной активации и не удачной
Убрать везде вопросы user?.info?.profile?.name заменив тернарными выражениямина проверку user
Одинаковый naming ВЕЗДЕ
Если пользователь зашел с гугл - нужно убрать возможность смены пароля
Проверить выдется ли новый токен с новыми данными После изменения профиля пользователя, нужно выписать ему новые токены, с новыми данными. Иначе неактуальные данные будут сидеть в токене

- Поле телефона у пользователя
- Удалять документ в модели токена при истечении refreshToken
- При продаже / сообщении - извещать админа
- реализовать фильтры товаров - по ценам, датам и тд
- Хрень которая срабатывает не на каждый чих инпута а в интрвале
- Оптимизация - useCallback useMemo
- При регистрации поле имя у пользователя брать из первой части имейла, и добавить возможность изменять имя в профиле
- Языки
- Темная / светлая тема - для начала только у панели админа
- <Layout> с брейкпоинтами
  // todo lazy loading kamasutra
  // TODO https://www.udemy.com/course/mern-ecommerce/learn/lecture/22498996#questions/12904054
  // TODO Не админ может получить любой order если знает orderId. Знать ID не своего заказа он вроде не может. Но нужна защита от дурака.
  // TODO исключить возможность попытки смены имейла - только удаление пользователя админом с запросом пароля админа.

// todo <Redirect to="/" />
// todo декомпозировать в компонент <FileUploader> ту часть что отвечает за подгрузку

Удалить lodash заменив своими функциями ???

- Бронь товара на несколько минут при оформлении покупки (если сайт от этого зависит)
- Доделать AutoResizeTextarea / Range
